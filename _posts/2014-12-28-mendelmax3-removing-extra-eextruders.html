---
layout: post
title: MendelMax3 - Removing extra extruders from GLCD
date: '2014-12-28T00:00:00.000-08:00'
author: Dave Hylands
tags:
- MM3
modified_time: '2014-12-28T01:45:56.465-08:00'
thumbnail: http://1.bp.blogspot.com/-knzYtiHEoWo/VJ-jccLmUII/AAAAAAAAb_M/DkZCNHx8cmc/s72-c/status_screen0_115x19.png
blogger_id: tag:blogger.com,1999:blog-2189571833278528716.post-2660604630039872596
blogger_orig_url: http://blog.davehylands.com/2014/12/mendelmax3-removing-extra-eextruders.html
---

By default the GLCD display always shows 3 extruders, even when you only have one or two installed.<br /><br />This blog post will show you how to modify your firmware to only display the number of extruders that you have configured.<br /><br />The MendelMax3 uses a <a href="https://ultimachine.com/content/rambo-13" target="_blank">RAMBo</a> board, which runs Marlin firmware. I created a github repository containing the initial firmware image I got from <a href="http://makerstoolworks.com/" target="_blank">MakersToolWorks (MTW)</a>. The master branch of my <a href="https://github.com/dhylands/MM3-Firmware/" target="_blank">repo</a> contains the original code I got from MTW. The <a href="https://github.com/dhylands/MM3-Firmware/tree/test" target="_blank">test branch</a> contains my changes. <br /><br />After poking around for&nbsp; a bit, I determined that the <a href="https://github.com/dhylands/MM3-Firmware/blob/master/MTW_Marlin/Marlin/dogm_lcd_implementation.h#L158-L326" target="_blank"><span class="pl-en">lcd_implementation_status_screen</span></a><span class="pl-en"> routine draws the main status screen. The extruders appeared to be drawn as part of <a href="https://github.com/dhylands/MM3-Firmware/blob/master/MTW_Marlin/Marlin/dogm_lcd_implementation.h#L166-L167" target="_blank">these two lines of code</a> which basically draws a bitmap.</span><br /><span class="pl-en"><br /></span><span class="pl-en">The bitmaps are contained in the <a href="https://github.com/dhylands/MM3-Firmware/blob/master/MTW_Marlin/Marlin/DOGMbitmaps.h" target="_blank">DOGMbitmaps.h</a> file.</span><br /><span class="pl-en"><br /></span><span class="pl-en">To clarify what I was seeing, I whipped up a quick and dirty python script to convert the monochrome bitmap into a raw RGB image.</span><br /><pre class="prettyprint"><span class="python">#!/usr/bin/python -u<br /><br />"""Program which converts an ASCII test into raw binary"""<br /><br />from __future__ import print_function<br />import argparse<br />import os<br />import sys<br /><br />def main():<br />    parser = argparse.ArgumentParser(<br />        prog="txt2raw.py",<br />        usage="%(prog)s text-file",<br />        description="Convert a text file of ASCII hex into raw binary"<br />    )<br />    parser.add_argument(<br />        dest="txt_filename",<br />        help="Name of text file"<br />    )<br />    args = parser.parse_args(sys.argv[1:])<br />    raw_root, raw_ext = os.path.splitext(args.txt_filename)<br />    raw_filename = raw_root + ".data"<br /><br />    print("txt_filename =", args.txt_filename)<br />    print("raw_filename =", raw_filename)<br /><br />    with open(args.txt_filename, 'rb') as txt_f:<br />        with open(raw_filename, 'wb') as raw_f:<br />            for line in txt_f:<br />                line = line.rstrip()<br />                for val in line.split(','):<br />                    if val:<br />                        num = int(val, 0)<br />                        for i in range(8):<br />                            if num &amp; (1 &lt;&lt; (7 - i)):<br />                                raw_f.write(b'\x00\x00\x00')<br />                            else:<br />                                raw_f.write(b'\xff\xff\xff')<br /><br />main()<br /></span></pre><span class="pl-en"><br /></span><span class="pl-en">Running this on status_screen0_bmp yielded a raw RGB file, which I opened in gimp and set the width to 120, and height to 19 giving:</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="{{ site.url }}/assets/2014-12-28/image-0000.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="{{ site.url }}/assets/2014-12-28/image-0000.png" /></a></div>and status_screen1_bmp showed:<br /><div class="separator" style="clear: both; text-align: center;"><a href="{{ site.url }}/assets/2014-12-28/image-0001.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="{{ site.url }}/assets/2014-12-28/image-0001.png" /></a></div><br /><span class="pl-en">which are the 2 bitmaps used to animate the cooling fans. G</span><script>prettyPrint(); </script><span class="pl-en">etting rid of the extra extruders means that the bitmap will need to be modified.</span><br /><span class="pl-en">&nbsp;</span><script>prettyPrint(); </script><br /><span class="pl-en">Looking at the ASCII data:</span><br /><pre class="prettyprint"><span class="nocode">0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0xE0,<br />0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0xE0,<br />0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x63,0x0C,0x60,<br />0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x47,0x0E,0x20,<br />0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4F,0x0F,0x20,<br />0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5F,0x0F,0xA0,<br />0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5E,0x07,0xA0,<br />0x7F,0x80,0x00,0x3F,0xC0,0x00,<span style="color: red;">0x3F,0xC0</span>,0x00,0x41,0x04,0x00,0x40,0x60,0x20,<br />0xFB,0xC0,0x00,0x79,0xE0,0x00,<span style="color: red;">0x79,0xE0</span>,0x00,0x20,0x82,0x00,0x40,0xF0,0x20,<br />0xF3,0xC0,0x00,0x76,0xE0,0x00,<span style="color: red;">0x76,0xE0</span>,0x00,0x20,0x82,0x00,0x40,0xF0,0x20,<br />0xEB,0xC0,0x00,0x7E,0xE0,0x00,<span style="color: red;">0x7E,0xE0</span>,0x00,0x41,0x04,0x00,0x40,0x60,0x20,<br />0x7B,0x80,0x00,0x3D,0xC0,0x00,<span style="color: red;">0x39,0xC0</span>,0x00,0x82,0x08,0x00,0x5E,0x07,0xA0,<br />0x7B,0x80,0x00,0x3B,0xC0,0x00,<span style="color: red;">0x3E,0xC0</span>,0x01,0x04,0x10,0x00,0x5F,0x0F,0xA0,<br />0xFB,0xC0,0x00,0x77,0xE0,0x00,<span style="color: red;">0x76,0xE0</span>,0x01,0x04,0x10,0x00,0x4F,0x0F,0x20,<br />0xFB,0xC0,0x00,0x70,0xE0,0x00,<span style="color: red;">0x79,0xE0</span>,0x00,0x82,0x08,0x00,0x47,0x0E,0x20,<br />0xFF,0xC0,0x00,0x7F,0xE0,0x00,<span style="color: red;">0x7F,0xE0</span>,0x00,0x41,0x04,0x00,0x63,0x0C,0x60,<br />0x3F,0x00,0x00,0x1F,0x80,0x00,<span style="color: red;">0x1F,0x80</span>,0x00,0x00,0x00,0x00,0x70,0x00,0xE0,<br />0x1E,0x00,0x00,0x0F,0x00,0x00,<span style="color: red;">0x0F,0x00</span>,0x01,0xFF,0xFF,0x80,0x7F,0xFF,0xE0,<br />0x0C,0x00,0x00,0x06,0x00,0x00,<span style="color: red;">0x06,0x00</span>,0x01,0xFF,0xFF,0x80,0x00,0x00,0x00</span></pre><span class="pl-en">The numbers highlighted in red is the bitmap data for the #3 extruder. You can see similar columns of numbers to the left for extruders #1 and #2. Replacing the red numbers with 0x00 will make the extruder disappear.</span><br /><br /><span class="pl-en">So I copied and pasted the data and added:</span><br /><pre class="prettyprint"><span class="C">#if EXTRUDERS &gt; 2<br />...include original bitmaps...<br />#elif EXTRUDERS &gt; 1<br />...include modified bitmap with extruder 3 blanked out...<br />#else<br />...include modified bitmap with extruders 2 &amp; 3 blanked out...<br />#endif</span></pre><span class="pl-en">You can find these changes <a href="https://github.com/dhylands/MM3-Firmware/blob/test/MTW_Marlin/Marlin/DOGMbitmaps.h#L80-L236" target="_blank">here</a>.</span><span class="C">Later on in the lcd_implementation_status_screen routine, it prints a line of 3 dashes underneath the extruder, and since we no longer have the extruders, I commented the code that prints the dashes out <a href="https://github.com/dhylands/MM3-Firmware/blob/test/MTW_Marlin/Marlin/dogm_lcd_implementation.h#L235-L237" target="_blank">here</a> and <a href="https://github.com/dhylands/MM3-Firmware/blob/test/MTW_Marlin/Marlin/dogm_lcd_implementation.h#L256-L258" target="_blank">here</a>.</span><br /><br /><span class="C">For my configuration, EXTRUDERS is set to 2, and now my GLCD screen looks like this:</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="{{ site.url }}/assets/2014-12-28/image-0002.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="{{ site.url }}/assets/2014-12-28/image-0002.jpg" height="360" width="640" /></a></div><br /><span class="C">I changed the "MendelMax2" to "Dave's MM3" by changing <a href="https://github.com/dhylands/MM3-Firmware/blob/test/MTW_Marlin/Marlin/language.h#L36-L37" target="_blank">language.h</a>&nbsp;</span>